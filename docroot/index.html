<!DOCTYPE html>
<!-- Copied from https://stackoverflow.com/a/60634123 -->

<head>
  <title>Graph</title>
  <style>
    .links line {
      stroke: #999;
      stroke-opacity: 0.6;
    }

    .nodes circle {
      stroke: #000;
      stroke-width: 1.5px;
    }

    text {
      font-size: 10px;
    }
  </style>
  <script src="https://d3js.org/d3.v4.min.js"></script>
</head>

<body>
  <svg width="800" height="600"></svg>
  <script>

    var graph = { "nodes": [], "links": [] };

    var svg = d3.select("svg"),
      width = +svg.attr("width"),
      height = +svg.attr("height")

    var g;
    var simulation;
    var linkElements, nodeElements, textElements;
    var color = d3.scaleOrdinal(d3.schemeCategory10);

    d3.json("graph.json", function (error, data) {
      if (error) throw error;

      graph = data;

      simulation = d3.forceSimulation()
        .force("link", d3.forceLink().distance(100).id(function (d) { // distance set length of links
          return d.id;
        }))
        .force("charge", d3.forceManyBody().strength(-500)) // strength sets repelling force
        .force("center", d3.forceCenter(width / 2, height / 2));

      g = svg.append("g")
        .attr("class", "everything");

      linkElements = svg.append("g").selectAll(".link");
      nodeElements = svg.append("g").selectAll(".nodes");
      textElements = svg.append("g").selectAll(".texts");

      drawGraph();


      simulation
        .nodes(graph.nodes)
        .on("tick", ticked);

      simulation.force("link")
        .links(graph.links);
    });


    function drawGraph() {

      // empty current Graph contents
      g.html('')


      linkElements = g.append("g")
        .attr("class", "links")
        .selectAll("line")
        .data(graph.links)
        .enter().append("line")
        .style("stroke-width", 3)
        .style("stroke", "grey")


      nodeElements = g.append("g")
        .attr("class", "nodes")
        .selectAll("circle")
        .data(graph.nodes)
        .enter().append("circle")
        .attr("r", 20)  // adjust this value to set radius of node

        .attr("stroke", "#fff")
        .attr('stroke-width', 21)
        .attr("id", function (d) {
          return d.id
        })
        .attr("fill", function (d) {
          return color(d.group)
        })
        .on("click", selectNode)
        .call(d3.drag()
          .on("start", dragstarted)
          .on("drag", dragged)
          .on("end", dragended));

      textElements = g.append("g")
        .attr("class", "texts")
        .selectAll("text")
        .data(graph.nodes)
        .enter().append("text")
        .attr("text-anchor", "end")
        .text(function (node) {
          return node.id
        })
        .attr("font-size", 55)
        .attr("font-family", "sans-serif")
        .attr("fill", "black")
        .attr("style", "font-weight:bold;")
        .attr("dx", 30)
        .attr("dy", 40) // vertical position of text

    }

    function ticked() {
      linkElements
        .attr("x1", function (d) {
          return d.source.x;
        })
        .attr("y1", function (d) {
          return d.source.y;
        })
        .attr("x2", function (d) {
          return d.target.x;
        })
        .attr("y2", function (d) {
          return d.target.y;
        });
      nodeElements
        .attr("cx", function (d) {
          return d.x;
        })
        .attr("cy", function (d) {
          return d.y;
        })
        .each(d => {
          d3.select('#t_' + d.id).attr('x', d.x + 10).attr('y', d.y + 3);
        });
      textElements
        .attr('x', function (d) {
          return d.x
        })
        .attr('y', function (d) {
          return d.y
        });
    }

    function selectNode(d) {
      console.log(d);
    }


    function dragstarted(d) {
      if (!d3.event.active) simulation.alphaTarget(0.3).restart();
      d.fx = d.x;
      d.fy = d.y;
    }

    function dragged(d) {
      d.fx = d3.event.x;
      d.fy = d3.event.y;
    }

    function dragended(d) {
      if (!d3.event.active) simulation.alphaTarget(0);
      d.fx = null;
      d.fy = null;
    }

  </script>
</body>